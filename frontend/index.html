<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema Inteligente de Calidad del Aire</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg:#0f172a;
  --card:#1e293b;
  --text:#f1f5f9;
  --muted:#94a3b8;
}

body.light{
  --bg:#f1f5f9;
  --card:#ffffff;
  --text:#0f172a;
  --muted:#475569;
}

body{
  margin:0;
  font-family:Inter,Segoe UI;
  background:var(--bg);
  color:var(--text);
  transition:0.4s;
}

header{
  display:flex;
  justify-content:space-between;
  padding:18px 30px;
  background:rgba(255,255,255,0.05);
  backdrop-filter:blur(8px);
}

button{
  border:none;
  padding:8px 14px;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
}

.download-btn{background:#2563eb;color:white}
.theme-btn{background:#64748b;color:white}

.hero{text-align:center;padding:40px 20px}

.hero h1{
  font-size:34px;
  background:linear-gradient(90deg,#3b82f6,#22c55e);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

/* INDICADOR PRINCIPAL */

.main-indicator{
  text-align:center;
  margin:40px 0;
}

.pm-value{
  font-size:60px;
  font-weight:700;
  transition:0.5s;
}

.pm-status{
  font-size:20px;
  font-weight:600;
}

.dynamic-bar{
  max-width:600px;
  height:14px;
  border-radius:10px;
  background:linear-gradient(90deg,#22c55e,#eab308,#ef4444);
  margin:20px auto;
  position:relative;
}

.marker{
  width:18px;
  height:18px;
  border-radius:50%;
  background:white;
  position:absolute;
  top:-2px;
  transform:translateX(-50%);
  transition:0.5s;
}

/* CARDS */

.container{max-width:1100px;margin:auto;padding:20px}

.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
  gap:25px;
  margin:40px 0;
}

.card{
  background:var(--card);
  padding:25px;
  border-radius:18px;
  transition:0.3s;
}

.card:hover{transform:translateY(-6px)}

/* CHART */

.chart-container{
  background:var(--card);
  padding:25px;
  border-radius:18px;
  height:400px;
  margin-bottom:60px;
}

/* INFO */

.info-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:25px;
}

.info-card{
  background:var(--card);
  padding:25px;
  border-radius:18px;
}

/* FOOTER */

footer{
  margin-top:80px;
  padding:30px;
  text-align:center;
  color:var(--muted);
  border-top:1px solid rgba(255,255,255,0.1);
}
</style>
</head>

<body>

<header>
<div><strong>游꺎 Sistema Inteligente de Calidad del Aire</strong></div>
<div>
<button class="download-btn" onclick="downloadExcel()">Descargar Excel</button>
<button class="theme-btn" onclick="toggleTheme()">Modo</button>
</div>
</header>

<section class="hero">
<h1>Monitoreo Avanzado de PM2.5</h1>
</section>

<div class="main-indicator">
<div class="pm-value" id="pmBig">--</div>
<div class="pm-status" id="pmStatus">Cargando...</div>
<div class="dynamic-bar">
<div class="marker" id="marker"></div>
</div>
</div>

<div class="container">

<div class="cards">
<div class="card">
<h3>Temperatura</h3>
<h2 id="temp">--</h2>
</div>
<div class="card">
<h3>Humedad</h3>
<h2 id="hum">--</h2>
</div>
</div>

<div class="chart-container">
<canvas id="chart"></canvas>
</div>

<div class="info-grid">
<div class="info-card">
<h3>Impacto en la salud</h3>
<p>El PM2.5 puede generar enfermedades respiratorias y cardiovasculares.</p>
</div>
<div class="info-card">
<h3>Fuentes principales</h3>
<p>Transporte, industrias, combusti칩n de biomasa.</p>
</div>
<div class="info-card">
<h3>Prevenci칩n</h3>
<p>Reducci칩n de emisiones y monitoreo continuo.</p>
</div>
</div>

</div>

<footer>
Plataforma desarrollada por<br>
<strong>Santiago Rubio & Jheferson Imbachi</strong><br>
춸 <span id="year"></span> Ingenier칤a Inform치tica
</footer>

<script>
const API_URL="https://air-quality-backend-66j2.onrender.com"

const ctx=document.getElementById("chart").getContext("2d")
const chart=new Chart(ctx,{
type:"line",
data:{labels:[],datasets:[{
data:[],
borderColor:"#3b82f6",
backgroundColor:"rgba(59,130,246,0.2)",
fill:true,
tension:0.4
}]},
options:{responsive:true,maintainAspectRatio:false}
})

function getStatus(pm){
if(pm<=12)return ["BUENA","#22c55e"]
if(pm<=35)return ["MODERADA","#eab308"]
return ["CR칈TICA","#ef4444"]
}

async function loadData(){
const res=await fetch(`${API_URL}/data`)
const data=await res.json()
if(!data.length)return
const latest=data[0]

document.getElementById("temp").innerText=latest.temperature+" 춿C"
document.getElementById("hum").innerText=latest.humidity+" %"
document.getElementById("pmBig").innerText=latest.pm25

const [status,color]=getStatus(latest.pm25)
document.getElementById("pmStatus").innerText=status
document.getElementById("pmBig").style.color=color

const marker=document.getElementById("marker")
marker.style.left=Math.min((latest.pm25/60)*100,100)+"%"

chart.data.labels=data.slice(0,15).map(d=>new Date(d.created_at).toLocaleTimeString()).reverse()
chart.data.datasets[0].data=data.slice(0,15).map(d=>d.pm25).reverse()
chart.update()
}

function downloadExcel(){window.open(`${API_URL}/download`)}
function toggleTheme(){document.body.classList.toggle("light")}
document.getElementById("year").innerText=new Date().getFullYear()

loadData()
setInterval(loadData,5000)
</script>

</body>
</html>
