<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<title>Sistema Inteligente de Calidad del Aire</title>

<style>
:root{
--bg:#0b1220;
--card:#111827;
--card2:#0f172a;
--text:#f8fafc;
--muted:#94a3b8;
--border:rgba(255,255,255,0.05);
}

*{box-sizing:border-box}

body{
margin:0;
font-family:'Inter',sans-serif;
background:linear-gradient(180deg,#0b1220,#0f172a);
color:var(--text);
overflow-x:hidden;
}

.wrapper{
max-width:1200px;
margin:auto;
padding:60px 20px;
}

/* Animaciones */

.fade{
opacity:0;
transform:translateY(30px);
transition:all .9s cubic-bezier(.16,1,.3,1);
}

.fade.show{
opacity:1;
transform:translateY(0);
}

/* Header */

header{
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:70px;
flex-wrap:wrap;
gap:15px;
}

.brand{
font-weight:700;
font-size:20px;
letter-spacing:-0.5px;
}

.status{
display:flex;
align-items:center;
gap:10px;
font-size:14px;
}

.dot{
width:10px;
height:10px;
border-radius:50%;
}

.connected{background:#22c55e}
.disconnected{background:#ef4444}

button{
background:#1f2937;
color:white;
border:1px solid var(--border);
padding:8px 14px;
border-radius:12px;
cursor:pointer;
transition:.3s;
}

button:hover{
transform:translateY(-2px);
background:#2563eb;
}

/* Hero */

.hero{
text-align:center;
margin-bottom:70px;
}

.hero h1{
font-size:44px;
font-weight:800;
letter-spacing:-1px;
background:linear-gradient(90deg,#3b82f6,#22c55e);
-webkit-background-clip:text;
-webkit-text-fill-color:transparent;
}

.hero p{
color:var(--muted);
max-width:650px;
margin:20px auto;
}

.clock{
font-size:14px;
color:var(--muted);
}

/* Main Card */

.main-card{
background:var(--card);
padding:60px;
border-radius:30px;
text-align:center;
box-shadow:0 30px 80px rgba(0,0,0,0.5);
margin-bottom:70px;
position:relative;
overflow:hidden;
}

.pm-value{
font-size:80px;
font-weight:800;
transition:.5s;
}

.pm-label{
font-size:24px;
margin-top:10px;
}

.pm-info{
margin-top:10px;
color:var(--muted);
}

/* ===== BARRA PREMIUM ===== */

.bar-wrapper{
max-width:650px;
margin:40px auto 0;
}

.bar{
height:16px;
border-radius:20px;
background:linear-gradient(90deg,
#22c55e 0%,#22c55e 33%,
#eab308 33%,#eab308 66%,
#ef4444 66%,#ef4444 100%);
position:relative;
box-shadow:inset 0 0 15px rgba(0,0,0,0.4);
}

.marker{
width:22px;
height:22px;
background:white;
border-radius:50%;
position:absolute;
top:-3px;
transform:translateX(-50%);
transition:.6s cubic-bezier(.16,1,.3,1);
box-shadow:0 0 15px rgba(255,255,255,0.7);
}

.range-labels{
display:flex;
justify-content:space-between;
margin-top:14px;
font-size:13px;
font-weight:600;
letter-spacing:0.3px;
}

.range{
padding:4px 10px;
border-radius:20px;
opacity:.5;
transition:.4s;
}

.range.active{
opacity:1;
transform:scale(1.05);
box-shadow:0 0 15px rgba(255,255,255,0.1);
}

.range.good{color:#22c55e}
.range.moderate{color:#eab308}
.range.bad{color:#ef4444}

/* Metrics */

.metrics{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
gap:30px;
margin-bottom:70px;
}

.metric{
background:var(--card2);
padding:40px;
border-radius:25px;
text-align:center;
border:1px solid var(--border);
transition:.4s;
}

.metric:hover{
transform:translateY(-6px);
box-shadow:0 20px 40px rgba(0,0,0,0.4);
}

.metric h3{
margin-bottom:10px;
font-weight:600;
}

.metric h2{
font-size:34px;
font-weight:700;
}

/* Analysis */

.analysis{
background:var(--card);
padding:45px;
border-radius:30px;
border:1px solid var(--border);
margin-bottom:70px;
}

.analysis h3{
margin-bottom:20px;
}

.analysis-grid{
display:grid;
grid-template-columns:1fr 1fr;
gap:30px;
}

.analysis-box{
background:var(--card2);
padding:25px;
border-radius:20px;
border:1px solid var(--border);
}

.analysis-box h4{
margin-bottom:10px;
font-size:15px;
color:#3b82f6;
}

.analysis-box p{
font-size:14px;
color:var(--muted);
line-height:1.6;
}

/* Chart */

.chart-card{
background:var(--card);
padding:40px;
border-radius:30px;
height:500px;
border:1px solid var(--border);
margin-bottom:80px;
}

/* Footer */

footer{
text-align:center;
color:var(--muted);
font-size:14px;
padding-bottom:40px;
border-top:1px solid var(--border);
padding-top:30px;
}
</style>
</head>

<body>
<div class="wrapper">

<header class="fade">
<div class="brand">Sistema Inteligente de Calidad del Aire</div>
<div class="status">
<div id="dot" class="dot disconnected"></div>
<span id="statusText">Sin conexión</span>
<button onclick="downloadExcel()">Descargar Excel</button>
</div>
</header>

<section class="hero fade">
<h1>Monitoreo Inteligente PM2.5</h1>
<p>Plataforma IoT para análisis ambiental avanzado en tiempo real.</p>
<div class="clock" id="clock"></div>
</section>

<div class="main-card fade">
<div class="pm-value" id="pmValue">--</div>
<div class="pm-label" id="pmLabel"></div>
<div class="pm-info" id="pmInfo"></div>

<div class="bar-wrapper">
<div class="bar">
<div class="marker" id="marker"></div>
</div>

<div class="range-labels">
<span id="rangeGood" class="range good">0 – 12 Buena</span>
<span id="rangeModerate" class="range moderate">12 – 35 Moderada</span>
<span id="rangeBad" class="range bad">35+ Crítica</span>
</div>
</div>
</div>

<div class="metrics fade">
<div class="metric">
<h3>Temperatura</h3>
<h2 id="temp">--</h2>
</div>
<div class="metric">
<h3>Humedad</h3>
<h2 id="hum">--</h2>
</div>
</div>

<div class="analysis fade">
<h3>Análisis Técnico Ambiental</h3>
<div class="analysis-grid">
<div class="analysis-box">
<h4>Estado Actual</h4>
<p id="estadoBox"></p>
</div>
<div class="analysis-box">
<h4>Impacto en Salud</h4>
<p id="saludBox"></p>
</div>
<div class="analysis-box">
<h4>Tendencia Detectada</h4>
<p id="tendenciaBox"></p>
</div>
<div class="analysis-box">
<h4>Recomendación Técnica</h4>
<p id="recomendacionBox"></p>
</div>
</div>
</div>

<div class="chart-card fade">
<canvas id="chart"></canvas>
</div>

<footer>
Plataforma desarrollada por <strong>Santiago Rubio</strong> & <strong>Jheferson Imbachi</strong><br>
Proyecto de Ingeniería Informática – Sistema IoT de monitoreo ambiental
</footer>

</div>

<script>
const API_URL="https://air-quality-backend-66j2.onrender.com"

function updateClock(){
document.getElementById("clock").innerText=new Date().toLocaleString()
}
setInterval(updateClock,1000)
updateClock()

function getStatus(pm){
if(pm<=12)return ["BUENA","#22c55e"]
if(pm<=35)return ["MODERADA","#eab308"]
return ["CRÍTICA","#ef4444"]
}

async function loadData(){
try{
const res=await fetch(`${API_URL}/data`)
const data=await res.json()
if(!data.length)return

document.getElementById("dot").className="dot connected"
document.getElementById("statusText").innerText="Conectado"

const latest=data[0]
const [label,color]=getStatus(latest.pm25)

document.getElementById("pmValue").innerText=latest.pm25
document.getElementById("pmValue").style.color=color
document.getElementById("pmLabel").innerText=label

document.getElementById("marker").style.left=Math.min((latest.pm25/60)*100,100)+"%"

document.querySelectorAll(".range").forEach(r=>r.classList.remove("active"))
if(latest.pm25<=12)document.getElementById("rangeGood").classList.add("active")
else if(latest.pm25<=35)document.getElementById("rangeModerate").classList.add("active")
else document.getElementById("rangeBad").classList.add("active")

}catch{}
}

loadData()
setInterval(loadData,5000)

function downloadExcel(){
window.open(`${API_URL}/download`)
}
</script>

</body>
</html>
