<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- FUENTE MODERNA -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<title>Sistema Inteligente de Calidad del Aire</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg:#0f172a;
  --card:#1e293b;
  --text:#f8fafc;
  --muted:#94a3b8;
}

body{
  margin:0;
  font-family:'Inter', sans-serif;
  background:var(--bg);
  color:var(--text);
  transition:background 0.4s ease, color 0.4s ease;
}

/* ANIMACIONES */

.fade-up{
  opacity:0;
  transform:translateY(30px);
  transition:all 0.8s cubic-bezier(.16,1,.3,1);
}

.fade-up.visible{
  opacity:1;
  transform:translateY(0);
}

/* CONTENEDOR */

.wrapper{
  max-width:1200px;
  margin:auto;
  padding:60px 20px;
}

/* HEADER */

header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:60px;
}

.brand{
  font-weight:600;
  font-size:20px;
  letter-spacing:-0.3px;
}

.status{
  display:flex;
  align-items:center;
  gap:8px;
  font-size:14px;
}

.dot{
  width:10px;
  height:10px;
  border-radius:50%;
}

.connected{background:#22c55e}
.disconnected{background:#ef4444}

button{
  border:none;
  padding:8px 16px;
  border-radius:10px;
  cursor:pointer;
  font-weight:500;
  transition:all 0.3s ease;
}

button:hover{
  transform:translateY(-2px);
}

.download-btn{background:#2563eb;color:white}
.theme-btn{background:#334155;color:white}

/* HERO */

.hero{
  text-align:center;
  margin-bottom:60px;
}

.hero h1{
  font-size:42px;
  font-weight:700;
  letter-spacing:-1px;
  background:linear-gradient(90deg,#3b82f6,#22c55e);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

.hero p{
  max-width:700px;
  margin:20px auto;
  color:var(--muted);
  font-weight:400;
}

.clock{
  font-size:14px;
  color:var(--muted);
}

/* TARJETA PRINCIPAL */

.main-card{
  background:var(--card);
  padding:50px;
  border-radius:28px;
  text-align:center;
  margin-bottom:60px;
  box-shadow:0 20px 60px rgba(0,0,0,0.4);
  transition:all 0.4s ease;
}

.main-card:hover{
  transform:translateY(-6px);
}

.pm-big{
  font-size:72px;
  font-weight:700;
  transition:all 0.4s ease;
}

.pm-status{
  font-size:22px;
  margin-top:10px;
}

.recommendation{
  margin-top:10px;
  color:var(--muted);
}

/* BARRA */

.bar{
  margin:30px auto 0;
  max-width:600px;
  height:14px;
  border-radius:10px;
  background:linear-gradient(90deg,#22c55e,#eab308,#ef4444);
  position:relative;
}

.marker{
  width:18px;
  height:18px;
  background:white;
  border-radius:50%;
  position:absolute;
  top:-2px;
  transform:translateX(-50%);
  transition:0.4s ease;
}

/* METRICAS */

.metrics{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
  gap:30px;
  margin-bottom:60px;
}

.metric-card{
  background:var(--card);
  padding:35px;
  border-radius:24px;
  text-align:center;
  transition:all 0.3s ease;
  box-shadow:0 10px 30px rgba(0,0,0,0.3);
}

.metric-card:hover{
  transform:translateY(-6px);
}

/* ANALISIS */

.analysis{
  background:var(--card);
  padding:35px;
  border-radius:24px;
  margin-bottom:60px;
  box-shadow:0 10px 30px rgba(0,0,0,0.3);
}

/* GRAFICA */

.chart-card{
  background:var(--card);
  padding:35px;
  border-radius:24px;
  height:500px;
  margin-bottom:80px;
  box-shadow:0 10px 30px rgba(0,0,0,0.3);
}

/* FOOTER */

footer{
  text-align:center;
  font-size:14px;
  color:var(--muted);
  padding-bottom:40px;
}
</style>
</head>

<body>

<div class="wrapper">

<header class="fade-up">
<div class="brand">ðŸŒ« Sistema Inteligente de Calidad del Aire</div>
<div class="status">
<div id="dot" class="dot disconnected"></div>
<span id="statusText">Sin conexiÃ³n</span>
<button class="download-btn" onclick="downloadExcel()">Excel</button>
</div>
</header>

<section class="hero fade-up">
<h1>Monitoreo Inteligente de PM2.5</h1>
<p>Plataforma IoT para anÃ¡lisis ambiental avanzado en tiempo real.</p>
<div class="clock" id="clock"></div>
</section>

<div class="main-card fade-up">
<div class="pm-big" id="pmBig">--</div>
<div class="pm-status" id="pmStatus"></div>
<div class="recommendation" id="recommendation"></div>
<div class="bar">
<div class="marker" id="marker"></div>
</div>
</div>

<div class="metrics fade-up">
<div class="metric-card">
<h3>Temperatura</h3>
<h2 id="temp">--</h2>
</div>
<div class="metric-card">
<h3>Humedad</h3>
<h2 id="hum">--</h2>
</div>
</div>

<div class="analysis fade-up">
<h3>AnÃ¡lisis Inteligente</h3>
<p id="analysisText">Procesando datos...</p>
</div>

<div class="chart-card fade-up">
<canvas id="chart"></canvas>
</div>

<footer class="fade-up">
Plataforma desarrollada por<br>
<strong>Santiago Rubio & Jheferson Imbachi</strong><br>
Proyecto de IngenierÃ­a InformÃ¡tica â€“ 2026
</footer>

</div>

<script>
const API_URL="https://air-quality-backend-66j2.onrender.com"

/* ANIMACION SCROLL */
const observer=new IntersectionObserver(entries=>{
entries.forEach(entry=>{
if(entry.isIntersecting){
entry.target.classList.add("visible")
}
})
})
document.querySelectorAll(".fade-up").forEach(el=>observer.observe(el))

/* RELOJ */
function updateClock(){
document.getElementById("clock").innerText=new Date().toLocaleString()
}
setInterval(updateClock,1000)
updateClock()

function getStatus(pm){
if(pm<=12)return ["BUENA","#22c55e","Condiciones Ã³ptimas."]
if(pm<=35)return ["MODERADA","#eab308","PrecauciÃ³n en poblaciÃ³n sensible."]
return ["CRÃTICA","#ef4444","Evitar actividad fÃ­sica al aire libre."]
}

async function loadData(){
try{
const res=await fetch(`${API_URL}/data`)
const data=await res.json()
if(!data.length)return

document.getElementById("dot").className="dot connected"
document.getElementById("statusText").innerText="Conectado"

const latest=data[0]
const [status,color,reco]=getStatus(latest.pm25)

document.getElementById("pmBig").innerText=latest.pm25
document.getElementById("pmBig").style.color=color
document.getElementById("pmStatus").innerText=status
document.getElementById("recommendation").innerText=reco

document.getElementById("temp").innerText=latest.temperature+" Â°C"
document.getElementById("hum").innerText=latest.humidity+" %"

document.getElementById("analysisText").innerText=
`Nivel actual ${latest.pm25} Âµg/mÂ³ (${status}). Tendencia ${
data[1] && latest.pm25>data[1].pm25?"ascendente":"estable o descendente"
}.`

document.getElementById("marker").style.left=
Math.min((latest.pm25/60)*100,100)+"%"

chart.data.labels=data.slice(0,20).map(d=>new Date(d.created_at).toLocaleTimeString()).reverse()
chart.data.datasets[0].data=data.slice(0,20).map(d=>d.pm25).reverse()
chart.update()

}catch{}
}

const ctx=document.getElementById("chart").getContext("2d")
const gradient=ctx.createLinearGradient(0,0,0,400)
gradient.addColorStop(0,"rgba(59,130,246,0.4)")
gradient.addColorStop(1,"rgba(59,130,246,0.05)")

const chart=new Chart(ctx,{
type:"line",
data:{labels:[],datasets:[{
data:[],
borderColor:"#3b82f6",
backgroundColor:gradient,
fill:true,
tension:0.45,
pointRadius:2
}]},
options:{
responsive:true,
maintainAspectRatio:false,
plugins:{legend:{display:false}},
scales:{x:{grid:{display:false}},y:{grid:{color:"rgba(255,255,255,0.05)"}}}
}
})

function downloadExcel(){window.open(`${API_URL}/download`)}

loadData()
setInterval(loadData,5000)
</script>

</body>
</html>
